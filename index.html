<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Fitness Tracker - Home Workouts</title>
    <meta name="theme-color" content="#00D0FF">
    <meta name="description" content="Fitness Tracker: Tu sistema de entrenamiento en casa">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* Custom CSS for Retro-Futuristic Theme */
        :root {
            --bg-color: #0a0e27;
            --card-bg: #1a1f3a;
            --primary: #00d4ff;
            --secondary: #00b8ff;
            --accent: #00f0ff;
            --accent-hover: #1dff7f;
            --metabolic: #ff006e;
            --border: #00d4ff;
            --glow-accent: 0 0 10px rgba(0, 212, 255, 0.8);
            --glow-metabolic: 0 0 15px rgba(255, 0, 110, 0.6);
        }

        body {
            background: linear-gradient(135deg, #0a0e27 0%, #1a0a2e 50%, #16213e 100%);
            color: var(--primary);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            padding-bottom: 6rem; /* Space for FAB */
            padding-top: 1rem;
            overflow-x: hidden;
        }

        h1, h2, h3, h4, h5 {
            font-family: 'Lora', serif;
        }

        .main-container {
            max-width: 900px;
            background-color: rgba(26, 31, 58, 0.8);
            padding: 1.5rem;
            border: 2px solid var(--accent);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.4), inset 0 0 20px rgba(0, 240, 255, 0.1);
        }

        .progress-bar-container {
            height: 0.75rem;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 9999px;
            overflow: hidden;
            border: 1px solid var(--accent);
            box-shadow: inset 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff 0%, #1dff7f 50%, #00f0ff 100%);
            transition: width 0.5s ease-in-out;
            border-radius: 9999px;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.8), 0 0 20px rgba(29, 255, 127, 0.6);
        }

        /* Navigation */
        .nav-tab {
            transition: all 0.2s ease;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: var(--secondary);
        }

        .nav-tab.tab-active {
            color: var(--accent);
            border-bottom-color: var(--accent);
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.8), 0 0 15px rgba(0, 240, 255, 0.5);
        }

        /* Content Sections */
        .content-section {
            display: none;
            padding: 1rem 0;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Calendar */
        .calendar-container {
            padding: 1rem;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid var(--accent);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.2);
        }

        .calendar-headers {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            margin-bottom: 0.5rem;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            font-size: 0.75rem;
            color: var(--accent);
            background: rgba(0, 212, 255, 0.1);
            text-shadow: 0 0 5px rgba(0, 212, 255, 0.6);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        /* Mobile: List view */
        @media (max-width: 768px) {
            .calendar-grid {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
                max-height: 70vh;
                overflow-y: auto;
                padding-right: 0.5rem;
            }
            .calendar-grid::-webkit-scrollbar {
                width: 6px;
            }
            .calendar-grid::-webkit-scrollbar-track {
                background: rgba(0, 212, 255, 0.1);
                border-radius: 10px;
            }
            .calendar-grid::-webkit-scrollbar-thumb {
                background: rgba(0, 212, 255, 0.4);
                border-radius: 10px;
            }
            .calendar-grid::-webkit-scrollbar-thumb:hover {
                background: rgba(0, 212, 255, 0.6);
            }
        }

        .calendar-day {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            padding: 0.5rem;
            font-size: 0.75rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: var(--accent);
            overflow: hidden;
        }

        /* Desktop: Square grid */
        @media (min-width: 769px) {
            .calendar-day {
                aspect-ratio: 1 / 1.1;
            }
        }

        /* Mobile: Full width list items */
        @media (max-width: 768px) {
            .calendar-day {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
                padding: 1rem;
                min-height: 70px;
                width: 100%;
            }
            .calendar-day > div:first-child {
                display: flex;
                align-items: center;
                gap: 1rem;
                flex: 1;
            }
            .calendar-day .font-bold {
                font-size: 1.25rem;
                min-width: 40px;
            }
        }
        .calendar-day::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.05), rgba(29, 255, 127, 0.05));
            pointer-events: none;
            border-radius: inherit;
        }
        .calendar-day > * {
            position: relative;
            z-index: 1;
        }
        .calendar-day .font-bold { font-size: 0.875rem; color: var(--accent); }
        .calendar-day .text-xs { font-size: 0.6rem; }

        .calendar-day[data-date]:hover {
            opacity: 1;
            transform: scale(1.08) translateY(-2px);
            z-index: 10;
            border-color: var(--accent-hover);
            box-shadow: 0 8px 20px rgba(0, 240, 255, 0.4), inset 0 0 15px rgba(29, 255, 127, 0.15), 0 0 15px rgba(0, 212, 255, 0.6);
            background: rgba(0, 20, 40, 0.6);
        }
        .calendar-day.today {
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.8), inset 0 0 15px rgba(0, 212, 255, 0.25), 0 4px 0px rgba(0, 212, 255, 0.5);
            background-color: rgba(0, 212, 255, 0.12) !important;
            border-width: 2px;
        }

        /* Animations and Visuals */
        .animated-text-glow {
            text-shadow: var(--glow-metabolic);
            color: var(--primary);
        }

        .metabolic-text {
            color: var(--metabolic) !important;
            text-shadow: 0 0 15px rgba(255, 0, 110, 0.8), 0 0 30px rgba(255, 0, 110, 0.5);
        }

        .metabolic-border {
            border-color: var(--metabolic) !important;
            box-shadow: 0 0 20px rgba(255, 0, 110, 0.4) inset, 0 0 30px rgba(255, 0, 110, 0.3);
        }

        .metabolic-shadow {
            box-shadow: 0 0 25px rgba(255, 0, 110, 0.6), 0 0 15px rgba(255, 0, 110, 0.3);
        }

        /* Exercise Library Cards */
        .exercise-card {
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            border-radius: 0.75rem;
            background: linear-gradient(135deg, rgba(10, 14, 39, 0.8), rgba(26, 31, 58, 0.8));
            border: 1px solid var(--accent);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3), inset 0 0 15px rgba(0, 240, 255, 0.1);
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .exercise-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        @media (min-width: 768px) {
            .exercise-content {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .section-title {
            color: var(--accent);
            font-weight: 600;
            margin-bottom: 0.75rem;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.8);
        }
        
        /* Celebration Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            z-index: 100;
            animation: fall linear forwards;
        }
        @keyframes fall {
            to { transform: translateY(100vh) rotate(720deg); }
        }

    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto main-container rounded-lg shadow-2xl border border-border">
        
        <header class="text-center my-6 mb-8 relative px-4">
            <div class="inline-block relative group cursor-default">
                <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold tracking-tight mb-2" 
                    style="color: var(--primary); text-shadow: 0 0 20px rgba(0, 212, 255, 0.6);">
                    Fitness Tracker
                </h1>
                <p class="text-lg text-secondary/80 tracking-wide">Tu entrenamiento en casa</p>
                
                <div class="w-24 h-1 bg-gradient-to-r from-accent via-metabolic to-accent mx-auto mt-4 rounded-full"></div>
            </div>
        </header>

        <div class="mb-6 p-4 bg-black/40 rounded-lg shadow-lg border border-accent/50 backdrop-blur-sm">
            <h2 class="text-center text-lg font-bold text-accent mb-3">üìä Progreso Mensual</h2>
            <div id="global-progress-text" class="text-center font-bold text-xl mb-2 text-emerald-400">0%</div>
            <div class="progress-bar-container">
                <div id="global-progress-bar" class="progress-bar" style="width: 0%;"></div>
            </div>
            <div id="global-stats" class="mt-4"></div>
        </div>

        <nav class="flex justify-between items-center border-b border-border mb-6">
            <div class="flex flex-wrap justify-center -mb-px overflow-x-auto flex-1">
                <button data-tab="hoy" class="nav-tab text-md py-3 px-3 font-semibold border-b-2 border-transparent text-secondary hover:text-accent whitespace-nowrap">üóìÔ∏è <span data-key="today">Hoy</span></button>
                <button data-tab="calendario" class="nav-tab text-md py-3 px-3 font-semibold border-b-2 border-transparent text-secondary hover:text-accent whitespace-nowrap">üìÖ <span data-key="calendar">Calendario</span></button>
                <button data-tab="rutinas" class="nav-tab text-md py-3 px-3 font-semibold border-b-2 border-transparent text-secondary hover:text-accent whitespace-nowrap">üèãÔ∏è‚Äç‚ôÇÔ∏è <span data-key="routines">Rutinas</span></button>
                <button data-tab="biblioteca" class="nav-tab text-md py-3 px-3 font-semibold border-b-2 border-transparent text-secondary hover:text-accent whitespace-nowrap">üìö <span data-key="library">Biblioteca</span></button>
            </div>
        </nav>

        <main id="main-content">
            <section id="hoy" class="content-section"></section>
            
            <section id="calendario" class="content-section">
                <div class="calendar-container w-full">
                    <div class="text-center mb-6">
                        <h2 id="calendar-title" class="text-2xl md:text-3xl font-bold text-accent mb-2" style="text-shadow: 0 0 15px rgba(0, 212, 255, 0.6);">üìÖ Diciembre 2025</h2>
                        <p class="text-sm text-secondary/70">Tu plan de entrenamiento mensual</p>
                    </div>
                    <div class="calendar-headers hidden md:grid">
                        <div class="calendar-day-header">Lun</div>
                        <div class="calendar-day-header">Mar</div>
                        <div class="calendar-day-header">Mi√©</div>
                        <div class="calendar-day-header">Jue</div>
                        <div class="calendar-day-header">Vie</div>
                        <div class="calendar-day-header">S√°b</div>
                        <div class="calendar-day-header">Dom</div>
                    </div>
                    <div id="calendar-body" class="calendar-grid"></div>
                </div>
            </section>
            
            <section id="rutinas" class="content-section">
                <div class="mb-6 text-center">
                    <h2 class="text-2xl md:text-3xl font-bold text-accent mb-2" style="text-shadow: 0 0 15px rgba(0, 212, 255, 0.6);">üèãÔ∏è Rutinas de Entrenamiento</h2>
                    <p class="text-sm text-secondary/70">Selecciona una rutina para ver los ejercicios</p>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-8">
                    <button data-routine="TORSO_PUSH" class="routine-selector bg-gradient-to-br from-sky-900/40 to-sky-800/20 hover:from-sky-800/60 hover:to-sky-700/40 text-sky-400 font-semibold py-4 px-4 border-2 border-sky-500/50 rounded-xl shadow-lg transition-all hover:scale-105 hover:shadow-sky-500/30">
                        <div class="text-2xl mb-1">üí™</div>
                        <span class="text-sm">Push</span>
                    </button>
                    <button data-routine="LEGS_ANKLES" class="routine-selector bg-gradient-to-br from-amber-900/40 to-amber-800/20 hover:from-amber-800/60 hover:to-amber-700/40 text-amber-400 font-semibold py-4 px-4 border-2 border-amber-500/50 rounded-xl shadow-lg transition-all hover:scale-105 hover:shadow-amber-500/30">
                        <div class="text-2xl mb-1">ü¶µ</div>
                        <span class="text-sm">Piernas</span>
                    </button>
                    <button data-routine="CORE_CARDIO" class="routine-selector bg-gradient-to-br from-pink-900/40 to-pink-800/20 hover:from-pink-800/60 hover:to-pink-700/40 text-pink-400 font-semibold py-4 px-4 border-2 border-pink-500/50 rounded-xl shadow-lg transition-all hover:scale-105 hover:shadow-pink-500/30">
                        <div class="text-2xl mb-1">üî•</div>
                        <span class="text-sm">Core & Cardio</span>
                    </button>
                    <button data-routine="TORSO_PULL" class="routine-selector bg-gradient-to-br from-sky-900/40 to-sky-800/20 hover:from-sky-800/60 hover:to-sky-700/40 text-sky-400 font-semibold py-4 px-4 border-2 border-sky-500/50 rounded-xl shadow-lg transition-all hover:scale-105 hover:shadow-sky-500/30">
                        <div class="text-2xl mb-1">üèãÔ∏è</div>
                        <span class="text-sm">Pull</span>
                    </button>
                    <button data-routine="GLUTES_CORE" class="routine-selector bg-gradient-to-br from-amber-900/40 to-amber-800/20 hover:from-amber-800/60 hover:to-amber-700/40 text-amber-400 font-semibold py-4 px-4 border-2 border-amber-500/50 rounded-xl shadow-lg transition-all hover:scale-105 hover:shadow-amber-500/30">
                        <div class="text-2xl mb-1">üçë</div>
                        <span class="text-sm">Gl√∫teos</span>
                    </button>
                    <button data-routine="METABOLIC" class="routine-selector bg-gradient-to-br from-pink-900/40 to-pink-800/20 hover:from-pink-800/60 hover:to-pink-700/40 text-pink-400 font-semibold py-4 px-4 border-2 border-pink-500/50 rounded-xl shadow-lg transition-all hover:scale-105 hover:shadow-pink-500/30">
                        <div class="text-2xl mb-1">‚ö°</div>
                        <span class="text-sm">Metab√≥lico</span>
                    </button>
                </div>
                <div id="routine-details-container"></div>
            </section>
            
            <section id="biblioteca" class="content-section">
                <div class="mb-8 text-center">
                    <h2 class="text-2xl md:text-3xl font-bold text-accent mb-2" style="text-shadow: 0 0 15px rgba(0, 212, 255, 0.6);">üìö Biblioteca de Ejercicios</h2>
                    <p class="text-sm text-secondary/70">Gu√≠a completa con t√©cnica y forma correcta</p>
                </div>
                <div id="exercise-library"></div>
            </section>
        </main>
    </div>

    <div id="exercise-modal" class="fixed inset-0 z-50 bg-black/80 backdrop-blur-sm hidden items-center justify-center p-4">
        <div class="bg-black/70 p-6 rounded-xl shadow-2xl border border-accent/50 w-full max-w-lg relative">
            <button id="modal-close" class="absolute top-3 right-3 text-2xl text-secondary hover:text-accent transition">‚ùå</button>
            <h2 id="guide-title" class="text-3xl font-bold text-accent mb-4 border-b border-accent/30 pb-2">Detalles del Ejercicio</h2>
            <div id="guide-content" class="space-y-4 text-white">
                <p>Cargando detalles...</p>
            </div>
        </div>
    </div>

    <script>
        // --- App Configuration ---
        const routines = {
            TORSO_PUSH: {
                title: 'üí™ C√ìDIGO: PUSH-ARMAMENTO SUPERIOR',
                description: 'Optimizaci√≥n de la propulsi√≥n pectoral, deltoides y extensores de mu√±eca. Fase de Fuerza I.',
                details: {
                    exercises: [
                        { name: 'Push-ups', series: 4, reps: 'AMRAP', rest: '60s', notes: 'Fuerza de pecho con calistenia.' },
                        { name: 'Pilates Bar Shoulder Press', series: 4, reps: '12-15', rest: '60s', notes: 'Pisa la banda para generar resistencia' },
                        { name: 'Band Flys', series: 3, reps: '15-20', rest: '45s', notes: 'Aislar y estirar el pecho' },
                        { name: 'Band Lateral Raises', series: 3, reps: '15-20', rest: '45s', notes: 'Ancho de hombros, usa banda' },
                        { name: 'Band Triceps Pushdowns', series: 3, reps: '15-20', rest: '45s', notes: 'Aislar tr√≠ceps' },
                        { name: 'Wrist Extension (Palms down)', series: 3, reps: '15-20', rest: '30s', notes: 'Salud de las articulaciones' }
                    ]
                }
            },
            LEGS_ANKLES: {
                title: 'ü¶µ C√ìDIGO: LEGS-UNIDAD DE MOVILIDAD',
                description: 'Aumento de la capacidad biomec√°nica del tren inferior. Estabilidad de articulaci√≥n y fuerza de propulsi√≥n.',
                details: {
                    exercises: [
                        { name: 'Pilates Bar Squat', series: 4, reps: '12-15', rest: '60s', notes: 'Pisa la banda, barra en la espalda' },
                        { name: 'Dumbbell Romanian Deadlift', series: 3, reps: '12-15', rest: '75s', notes: 'Enf√≥cate en los isquiotibiales' },
                        { name: 'Static Lunge (Ankle Focus)', series: 3, reps: '10-12/side', rest: '60s', notes: 'Controla la estabilidad del tobillo' },
                        { name: 'Banded Glute Bridge', series: 3, reps: '15-20', rest: '45s', notes: 'Banda en las rodillas, empuja hacia afuera' },
                        { name: 'Calf Raises (Ankle Focus)', series: 4, reps: '20-25', rest: '45s', notes: 'Con barra de pilates para resistencia' }
                    ]
                }
            },
            CORE_CARDIO: {
                title: 'üî• C√ìDIGO: CORE-FUSI√ìN METAB√ìLICA',
                description: 'Secuencia de choque para el core central y aceleraci√≥n de la tasa metab√≥lica basal. Alto Impacto.',
                details: {
                    exercises: [
                        { name: 'Plank Hold', series: 4, reps: '45-60s', rest: '45s', notes: 'Mant√©n el cuerpo recto, core activado' },
                        { name: 'Bicycle Crunches', series: 4, reps: '20-25', rest: '30s', notes: 'Toca codo con rodilla opuesta' },
                        { name: 'Burpees', series: 4, reps: '10-15', rest: '60s', notes: 'Explosivos, mant√©n buena forma' },
                        { name: 'Mountain Climbers', series: 4, reps: '30-40', rest: '45s', notes: 'Ritmo r√°pido pero controlado' },
                        { name: 'Russian Twists', series: 3, reps: '30-40', rest: '45s', notes: 'Usa banda o pilates bar, gira el torso' },
                        { name: 'Leg Raises', series: 3, reps: '12-15', rest: '45s', notes: 'Core bajo, piernas rectas' },
                        { name: 'Jump Squats', series: 3, reps: '15-20', rest: '60s', notes: 'Cardio explosivo, aterriza suave' }
                    ]
                }
            },
            TORSO_PULL: {
                title: 'üèãÔ∏è‚Äç‚ôÇÔ∏è C√ìDIGO: PULL-CADENA POSTERIOR',
                description: 'Desarrollo del segmento dorsal, flexores de brazo y extensores de antebrazo. Fase de Tracci√≥n I.',
                details: {
                    exercises: [
                        { name: 'Pilates Bar Lat Pulldown', series: 4, reps: '12-15', rest: '60s', notes: 'Anclaje alto en la puerta' },
                        { name: 'Dumbbell Bent-Over Row', series: 4, reps: '8-12', rest: '60s', notes: 'Fuerza y densidad de la espalda' },
                        { name: 'Band Face Pulls', series: 3, reps: '15-20', rest: '45s', notes: 'Salud y postura de los hombros' },
                        { name: 'Pilates Bar Bicep Curl', series: 3, reps: '12-15', rest: '45s', notes: 'Pisa la banda para generar resistencia' },
                        { name: 'Wrist Flexion (Palms up)', series: 3, reps: '15-20', rest: '30s', notes: 'Salud de las articulaciones' }
                    ]
                }
            },
            GLUTES_CORE: {
                title: 'üçë C√ìDIGO: GLUTES-N√öCLEO ESTABILIZADOR',
                description: 'Activaci√≥n profunda del complejo gl√∫teo y estabilidad del n√∫cleo espinal. Concentraci√≥n de Fuerza.',
                details: {
                    exercises: [
                        { name: 'Pull Through', series: 4, reps: '15-20', rest: '60s', notes: 'Anclaje bajo, enf√≥cate en los gl√∫teos' },
                        { name: 'Banded Lateral Walk', series: 3, reps: '12 steps/side', rest: '45s', notes: 'Banda en las rodillas o tobillos' },
                        { name: 'Pilates Bar Russian Twists', series: 3, reps: '20 twists', rest: '45s', notes: 'Sost√©n la barra, gira el torso' },
                        { name: 'Plank', series: 3, reps: '45-75s', rest: '60s', notes: 'Mant√©n el cuerpo recto' },
                        { name: 'Bird-Dog', series: 3, reps: '12/side', rest: '30s', notes: 'Movimiento lento y controlado' }
                    ]
                }
            },
            METABOLIC: {
                title: '‚ö° C√ìDIGO: SHOCK-CIRCUITO MAX. VEL.',
                description: 'Protocolo de resistencia m√°xima y quema de energ√≠a. Ejecuci√≥n en circuito sin pausa programada.',
                details: {
                    exercises: [
                        { name: 'Pilates Bar Thrusters', series: '4 Rounds', reps: '15', rest: '15s', notes: 'Sentadilla + Press de Hombros' },
                        { name: 'Fast Band Rows', series: '4 Rounds', reps: '20', rest: '15s', notes: 'Ritmo r√°pido' },
                        { name: 'Lunge with Twist', series: '4 Rounds', reps: '10/side', rest: '15s', notes: 'Con barra de pilates' },
                        { name: 'Jumping Jacks', series: '4 Rounds', reps: '45s', rest: '90s', notes: 'Descanso largo al final' }
                    ]
                }
            },
            REST: {
                title: 'ESTADO: REGENERACI√ìN DE SISTEMAS',
                description: 'El sistema entra en fase de reparaci√≥n sin√°ptica y crecimiento muscular. Priorizar el descanso.'
            }
        };

        const exerciseLibrary = {
            'Dumbbell Bench Press': { category: 'Chest', equipment: 'üèãÔ∏è Mancuernas', difficulty: 'Intermedio', form: { es: ['1. Acu√©state en un banco', '2. Sost√©n las mancernas a nivel del pecho', '3. Empuja las mancernas hacia arriba hasta extender los brazos'] }, tips: { es: ['‚úì Controla el peso en la bajada', '‚úó Evita: Codos muy abiertos'] }, muscleGroups: ['Pectoral', 'Tr√≠ceps'] },
            'Push-ups': { category: 'Chest', equipment: 'üõèÔ∏è Tapete', difficulty: 'Principiante', form: { es: ['1. Plancha alta, manos al ancho de hombros', '2. Baja el cuerpo hasta que el pecho casi toque el suelo', '3. Empuja de vuelta a la posici√≥n inicial'] }, tips: { es: ['‚úì Mant√©n el core contra√≠do', '‚úó Evita: Dejar caer las caderas'] }, muscleGroups: ['Pectoral', 'Core'] },
            'Pilates Bar Shoulder Press': { category: 'Shoulders', equipment: 'üéØ Barra Pilates', difficulty: 'Principiante', form: { es: ['1. Pisa la banda, barra a altura de hombros', '2. Empuja la barra hacia arriba hasta extender los brazos', '3. Baja con control'] }, tips: { es: ['‚úì Mant√©n la espalda recta', '‚úó Evita: Usar impulso para empujar'] }, muscleGroups: ['Hombros'] },
            'Band Flys': { category: 'Chest', equipment: 'üü∞ Bandas', difficulty: 'Principiante', form: { es: ['1. Fija la banda, extiende el brazo', '2. Trae el brazo cruzando el cuerpo en movimiento de abrazo', '3. Regresa con control'] }, tips: { es: ['‚úì Contrae el pecho al final', '‚úó Evita: Bloquear el codo'] }, muscleGroups: ['Pectoral'] },
            'Band Lateral Raises': { category: 'Shoulders', equipment: 'üü∞ Bandas', difficulty: 'Principiante', form: { es: ['1. P√°rate sobre la banda', '2. Eleva los brazos hacia los lados hasta la altura de los hombros', '3. Baja lentamente'] }, tips: { es: ['‚úì Codos ligeramente m√°s altos que las manos', '‚úó Evita: Balancear las bandas'] }, muscleGroups: ['Hombros (Lateral)'] },
            'Band Triceps Pushdowns': { category: 'Triceps', equipment: 'üü∞ Bandas', difficulty: 'Principiante', form: { es: ['1. Fija banda alta, codos a 90¬∞', '2. Empuja la banda hacia abajo hasta extender los brazos', '3. Regresa a nivel del pecho con control'] }, tips: { es: ['‚úì Codos pegados al cuerpo', '‚úó Evita: Dejar que los codos se abran'] }, muscleGroups: ['Tr√≠ceps'] },
            'Wrist Extension (Palms down)': { category: 'Forearms', equipment: 'üéØ Barra Pilates', difficulty: 'Principiante', form: { es: ['1. Antebrazo apoyado, palma hacia abajo', '2. Levanta la barra extendiendo la mu√±eca hacia arriba', '3. Baja con control'] }, tips: { es: ['‚úì Mu√©vete solo desde la mu√±eca', '‚úó Evita: Mover el antebrazo o codo'] }, muscleGroups: ['Antebrazos (Extensores)'] },
            'Pilates Bar Squat': { category: 'Legs', equipment: 'üéØ Barra Pilates', difficulty: 'Intermedio', form: { es: ['1. Pisa la banda, barra sobre los hombros', '2. Baja a sentadilla hasta paralelo', '3. Empuja a trav√©s de los talones para subir'] }, tips: { es: ['‚úì Mant√©n el pecho erguido', '‚úó Evita: Rodillas colapsando hacia adentro'] }, muscleGroups: ['Cu√°driceps', 'Gl√∫teos'] },
            'Dumbbell Romanian Deadlift': { category: 'Hamstrings', equipment: 'üèãÔ∏è Mancuernas', difficulty: 'Intermedio', form: { es: ['1. Ligero doblez en rodillas', '2. Bisagra desde las caderas, bajando el peso', '3. Empuja las caderas hacia adelante para volver a incorporarte'] }, tips: { es: ['‚úì Mant√©n la espalda recta', '‚úó Evita: Redondear la espalda baja'] }, muscleGroups: ['Isquiotibiales', 'Gl√∫teos'] },
            'Static Lunge (Ankle Focus)': { category: 'Legs', equipment: 'üõèÔ∏è Tapete', difficulty: 'Intermedio', form: { es: ['1. Da un paso adelante, ambas rodillas a 90¬∞', '2. Rodilla frontal alineada con el tobillo', '3. Mant√©n el torso erguido'] }, tips: { es: ['‚úì Enf√≥cate en la estabilidad del tobillo', '‚úó Evita: Rodilla frontal pasando los dedos'] }, muscleGroups: ['Cu√°driceps', 'Gl√∫teos', 'Estabilizadores'] },
            'Banded Glute Bridge': { category: 'Glutes', equipment: 'üü∞ Bandas', difficulty: 'Principiante', form: { es: ['1. Banda sobre las rodillas', '2. Empuja las rodillas hacia afuera contra la banda', '3. Levanta caderas, contrayendo gl√∫teos'] }, tips: { es: ['‚úì Mant√©n tensi√≥n en la banda', '‚úó Evita: Hiperextensi√≥n de espalda baja'] }, muscleGroups: ['Gl√∫teos', 'Isquiotibiales'] },
            'Calf Raises (Ankle Focus)': { category: 'Calves', equipment: 'üéØ Barra Pilates', difficulty: 'Principiante', form: { es: ['1. Eleva sobre los dedos, levantando talones alto', '2. Pausa brevemente en la parte superior', '3. Baja con control'] }, tips: { es: ['‚úì Rango completo de movimiento', '‚úó Evita: Rebotar'] }, muscleGroups: ['Pantorrillas', 'Tobillo'] },
            'Pilates Bar Lat Pulldown': { category: 'Back', equipment: 'üéØ Barra Pilates', difficulty: 'Principiante', form: { es: ['1. Fija banda alta, agarre ancho', '2. Jala la barra hacia abajo hasta nivel del pecho', '3. Regresa con control'] }, tips: { es: ['‚úì Contrae la espalda en la parte inferior', '‚úó Evita: Usar los brazos en lugar de la espalda'] }, muscleGroups: ['Dorsales', 'Espalda'] },
            'Dumbbell Bent-Over Row': { category: 'Back', equipment: 'üèãÔ∏è Mancuernas', difficulty: 'Intermedio', form: { es: ['1. Bisagra desde cadera, espalda paralela al suelo', '2. Jala las mancernas hacia la caja tor√°cica', '3. Baja con control'] }, tips: { es: ['‚úì Mant√©n core contra√≠do', '‚úó Evita: Redondear la espalda baja'] }, muscleGroups: ['Espalda', 'Dorsales'] },
            'Band Face Pulls': { category: 'Shoulders', equipment: 'üü∞ Bandas', difficulty: 'Principiante', form: { es: ['1. Fija banda a altura de la cara', '2. Jala la banda hacia la cara/cabeza', '3. Rota las manos hacia afuera al final'] }, tips: { es: ['‚úì Codos altos', '‚úó Evita: Jalar hacia abajo'] }, muscleGroups: ['Hombros (Posterior)', 'Espalda Superior'] },
            'Pilates Bar Bicep Curl': { category: 'Biceps', equipment: 'üéØ Barra Pilates', difficulty: 'Principiante', form: { es: ['1. Pisa la banda, brazos extendidos', '2. Dobla los codos, curva la barra hacia los hombros', '3. Baja con control'] }, tips: { es: ['‚úì Contrae los b√≠ceps en la parte superior', '‚úó Evita: Balancearte o usar impulso'] }, muscleGroups: ['B√≠ceps'] },
            'Wrist Flexion (Palms up)': { category: 'Forearms', equipment: 'üéØ Barra Pilates', difficulty: 'Principiante', form: { es: ['1. Antebrazo apoyado, palma hacia arriba', '2. Curva la mu√±eca hacia arriba', '3. Baja con control'] }, tips: { es: ['‚úì Mu√©vete solo desde la mu√±eca', '‚úó Evita: Mover antebrazo o codo'] }, muscleGroups: ['Antebrazos (Flexores)'] },
            'Pull Through': { category: 'Glutes', equipment: 'üü∞ Bandas', difficulty: 'Intermedio', form: { es: ['1. Fija la banda baja, de espaldas al anclaje', '2. Bisagra de cadera, empuja banda entre piernas', '3. Empuja las caderas hacia adelante (extensi√≥n completa)'] }, tips: { es: ['‚úì La fuerza viene de las caderas, no de los brazos', '‚úó Evita: Redondear la espalda baja'] }, muscleGroups: ['Gl√∫teos', 'Isquiotibiales'] },
            'Banded Lateral Walk': { category: 'Glutes', equipment: 'üü∞ Bandas', difficulty: 'Principiante', form: { es: ['1. Banda en rodillas/tobillos, semi-sentadilla', '2. Pasos laterales manteniendo tensi√≥n', '3. Alterna direcciones'] }, tips: { es: ['‚úì Mant√©n las rodillas dobladas', '‚úó Evita: Banda afloj√°ndose'] }, muscleGroups: ['Gl√∫teos (Medio)'] },
            'Pilates Bar Russian Twists': { category: 'Core', equipment: 'üéØ Barra Pilates', difficulty: 'Intermedio', form: { es: ['1. Sentado, torso inclinado (45¬∞)', '2. Sost√©n la barra, rota torso a izquierda/derecha', '3. Toca el suelo con la barra (opcional)'] }, tips: { es: ['‚úì La rotaci√≥n viene del core', '‚úó Evita: Moverte demasiado r√°pido'] }, muscleGroups: ['Oblicuos', 'Core'] },
            'Plank': { category: 'Core', equipment: 'üõèÔ∏è Tapete', difficulty: 'Principiante', form: { es: ['1. Plancha de antebrazos, codos bajo hombros', '2. Cuerpo en l√≠nea recta desde cabeza hasta talones', '3. Mant√©n la posici√≥n'] }, tips: { es: ['‚úì Core y gl√∫teos apretados', '‚úó Evita: Dejar caer las caderas'] }, muscleGroups: ['Core', 'Hombros'] },
            'Bird-Dog': { category: 'Core', equipment: 'üõèÔ∏è Tapete', difficulty: 'Principiante', form: { es: ['1. En cuatro patas', '2. Extiende brazo y pierna opuestos', '3. Regresa lentamente al inicio'] }, tips: { es: ['‚úì Mant√©n el cuerpo alineado', '‚úó Evita: Rotar caderas u hombros'] }, muscleGroups: ['Core', 'Gl√∫teos'] },
            'Pilates Bar Thrusters': { category: 'Full Body', equipment: 'üéØ Barra Pilates', difficulty: 'Avanzado', form: { es: ['1. Sentadilla completa', '2. Explota hacia arriba', '3. Empuja la barra sobre la cabeza en un solo movimiento'] }, tips: { es: ['‚úì Movimiento fluido y explosivo', '‚úó Evita: Profundidad incompleta de sentadilla'] }, muscleGroups: ['Cu√°driceps', 'Hombros', 'Full Body'] },
            'Fast Band Rows': { category: 'Back', equipment: 'üü∞ Bandas', difficulty: 'Intermedio', form: { es: ['1. Fija banda a altura del pecho', '2. Jala r√°pidamente la banda hacia el pecho', '3. Regreso r√°pido y controlado'] }, tips: { es: ['‚úì Ritmo r√°pido pero controlado', '‚úó Evita: Impulso excesivo'] }, muscleGroups: ['Espalda', 'Dorsales'] },
            'Lunge with Twist': { category: 'Full Body', equipment: 'üéØ Barra Pilates', difficulty: 'Intermedio', form: { es: ['1. Estocada, ambas rodillas a 90¬∞', '2. Sost√©n la barra, gira el torso sobre la pierna frontal', '3. Regresa y cambia de lado'] }, tips: { es: ['‚úì Gira desde el core, no desde los brazos', '‚úó Evita: Girar antes de estar estable'] }, muscleGroups: ['Cu√°driceps', 'Core', 'Gl√∫teos'] },
            'Jumping Jacks': { category: 'Cardio', equipment: 'üõèÔ∏è Espacio', difficulty: 'Principiante', form: { es: ['1. Salta abriendo piernas y brazos simult√°neamente', '2. Salta cerrando', '3. Repite en movimiento continuo'] }, tips: { es: ['‚úì Aterriza suavemente', '‚úó Evita: Golpear los pies al aterrizar'] }, muscleGroups: ['Full Body', 'Cardio'] },
            'Plank Hold': { category: 'Core', equipment: 'üõèÔ∏è Tapete', difficulty: 'Principiante', form: { es: ['1. Plancha de antebrazos', '2. Mant√©n el cuerpo en l√≠nea recta', '3. Contrae core y gl√∫teos'] }, tips: { es: ['‚úì Aprieta gl√∫teos para proteger la espalda baja', '‚úó Evita: Aguantar la respiraci√≥n'] }, muscleGroups: ['Core', 'Hombros'] },
            'Bicycle Crunches': { category: 'Core', equipment: 'üõèÔ∏è Tapete', difficulty: 'Intermedio', form: { es: ['1. Acu√©state, manos detr√°s de la cabeza', '2. Lleva codo a rodilla opuesta, extiende la otra pierna', '3. Contin√∫a alternando'] }, tips: { es: ['‚úì Toca codo con rodilla opuesta', '‚úó Evita: Jalar el cuello'] }, muscleGroups: ['Abs', 'Oblicuos'] },
            'Burpees': { category: 'Full Body', equipment: 'üõèÔ∏è Espacio', difficulty: 'Intermedio', form: { es: ['1. Baja a sentadilla', '2. Salta pies atr√°s a plancha', '3. Salta pies adelante a sentadilla', '4. Explota hacia arriba en salto'] }, tips: { es: ['‚úì Movimiento explosivo completo', '‚úó Evita: Forma descuidada cuando est√°s cansado'] }, muscleGroups: ['Full Body', 'Cardio', 'Core'] },
            'Mountain Climbers': { category: 'Cardio', equipment: 'üõèÔ∏è Tapete', difficulty: 'Intermedio', form: { es: ['1. Plancha alta', '2. Lleva rodilla al pecho, cambia r√°pidamente de pierna', '3. Contin√∫a alternando a ritmo r√°pido'] }, tips: { es: ['‚úì Ritmo r√°pido pero controlado', '‚úó Evita: Dejar rebotar las caderas'] }, muscleGroups: ['Core', 'Cardio'] },
            'Russian Twists': { category: 'Core', equipment: 'üéØ Barra Pilates', difficulty: 'Intermedio', form: { es: ['1. Sentado, torso inclinado (45¬∞)', '2. Gira el torso de lado a lado'] }, tips: { es: ['‚úì La rotaci√≥n viene del core', '‚úó Evita: Rotar demasiado lejos'] }, muscleGroups: ['Oblicuos', 'Core'] },
            'Leg Raises': { category: 'Core', equipment: 'üõèÔ∏è Tapete', difficulty: 'Intermedio', form: { es: ['1. Acu√©state, manos bajo gl√∫teos', '2. Eleva piernas hasta 90 grados', '3. Baja lentamente sin tocar el piso'] }, tips: { es: ['‚úì Presiona la espalda baja contra el piso', '‚úó Evita: Arquear la espalda baja'] }, muscleGroups: ['Abs (Bajo)', 'Flexores'] },
            'Jump Squats': { category: 'Legs', equipment: 'üõèÔ∏è Espacio', difficulty: 'Intermedio', form: { es: ['1. Baja a sentadilla completa', '2. Explota hacia arriba en salto', '3. Aterriza suavemente de vuelta a sentadilla'] }, tips: { es: ['‚úì Poder explosivo desde las piernas', '‚úó Evita: Aterrizar con rodillas bloqueadas'] }, muscleGroups: ['Cu√°driceps', 'Gl√∫teos', 'Cardio'] }
        };

        function getExerciseSlug(name) {
            return name.toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu, '').replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
        }
        function getExerciseName(englishName) { return englishName; } 
        function getExerciseDescription(englishName) {
            const allExercises = Object.values(routines).flatMap(r => r.details ? r.details.exercises : []);
            const ex = allExercises.find(e => e.name === englishName);
            return ex ? ex.notes : '';
        }

        // --- Date & Schedule ---
        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth();
        const day = today.getDate();
        let currentViewDate = new Date();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        function dateKeyFromDate(d) {
            return `${d.getFullYear()}-${d.getMonth() + 1}-${d.getDate()}`;
        }

        const LOCAL_STORAGE_KEY = 'ftber_progress';
        const schedulePattern = ['TORSO_PUSH', 'LEGS_ANKLES', 'CORE_CARDIO', 'TORSO_PULL', 'GLUTES_CORE', 'METABOLIC', 'REST'];
        const monthlySchedule = {};

        function generateMonthlySchedule() {
            for (let d = 1; d <= daysInMonth; d++) {
                const date = new Date(year, month, d);
                const dayOfWeek = date.getDay(); 
                const patternIndex = (dayOfWeek === 0) ? 6 : dayOfWeek - 1;
                monthlySchedule[d] = schedulePattern[patternIndex];
            }
        }
        generateMonthlySchedule();

        // --- Language ---
        const translations = { es: { today: 'Hoy', calendar: 'Calendario', routines: 'Rutinas', library: 'Biblioteca', dailyProgress: 'ESTADO DE LA SECUENCIA DIARIA', equipmentNeeded: 'UNIDADES DE REQUERIMIENTO', exercise: 'M√ìDULO DE ACCI√ìN', sets: 'CICLOS', reps: 'REPETICIONES', rest: 'COOLDOWN', notes: 'PAR√ÅMETROS', done: 'COMPLETADO', selectRoutineDesc: 'AN√ÅLISIS DE M√ìDULOS DE ENTRENAMIENTO.', exerciseLibraryDesc: 'BASE DE DATOS DE MOVIMIENTO.' } };
        function t(key) { return translations.es[key] || key; }

        function updateLanguageDisplay() {
            document.querySelectorAll('[data-key]').forEach(el => el.textContent = t(el.getAttribute('data-key')));
            document.querySelectorAll('[data-routine-key]').forEach(el => {
                const r = routines[el.getAttribute('data-routine-key')];
                if (r && r.title) el.textContent = r.title.includes(':') ? r.title.split(':')[1].split(' ')[1] : 'REGENERACI√ìN';
            });
        }

        // --- Core UI Functions ---
        function getRoutineColorClass(routineKey) {
            const isHighIntensity = routineKey === 'METABOLIC' || routineKey === 'CORE_CARDIO';
            if (isHighIntensity) return { text: 'text-metabolic', border: 'border-metabolic/50', shadow: 'shadow-metabolic', bg: 'bg-metabolic/10' };
            if (routineKey === 'REST') return { text: 'text-emerald-300', border: 'border-emerald-500/50', shadow: 'shadow-emerald-500', bg: 'bg-emerald-500/10' };
            if (routineKey.includes('PUSH') || routineKey.includes('PULL')) return { text: 'text-sky-400', border: 'border-sky-400/50', shadow: 'shadow-sky-400', bg: 'bg-sky-400/10' };
            if (routineKey.includes('LEGS') || routineKey.includes('GLUTES')) return { text: 'text-amber-400', border: 'border-amber-400/50', shadow: 'shadow-amber-400', bg: 'bg-amber-400/10' };
            return { text: 'text-secondary', border: 'border-border', shadow: '', bg: 'bg-card-bg/80' };
        }

        function createRoutineHeaderHTML(routineData, routineKey, isTodayView, dateParam) {
            const isHighIntensity = routineKey === 'METABOLIC' || routineKey === 'CORE_CARDIO';
            const isCurrentDay = isTodayView && dateParam && dateKeyFromDate(dateParam) === dateKeyFromDate(today);
            const dateLabel = dateParam ? dateParam.toLocaleDateString('es-ES', { weekday: 'long', month: 'short', day: 'numeric' }) : '';
            
            let progressHTML = '';
            let saveButtonHTML = '';
            if (isTodayView && routineData.details) {
                progressHTML = `
                    <div class="mb-6">
                        <h3 class="text-center font-bold text-xl mb-2 text-primary">${t('dailyProgress')}</h3>
                        <div id="progress-text" class="text-center font-bold text-lg text-accent" style="text-shadow: var(--glow-accent);">0% Completado</div>
                        <div id="progress-count" class="text-center text-secondary text-sm mt-1">0 de ${routineData.details.exercises.length} m√≥dulos</div>
                        <div class="progress-bar-container mt-3" style="height: 1rem;"><div id="progress-bar" class="progress-bar" style="width: 0%;"></div></div>
                    </div>`;
                
                // Mostrar bot√≥n de guardar cuando no es el d√≠a actual
                if (!isCurrentDay) {
                    saveButtonHTML = `<div class="mt-6 p-4 bg-accent/15 border-2 border-accent rounded-lg"><button id="save-day-btn" class="w-full px-4 py-3 bg-accent/25 hover:bg-accent/50 border border-accent text-accent rounded-lg font-bold transition text-base md:text-lg" style="text-shadow: 0 0 8px rgba(0, 212, 255, 0.8); box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);">üíæ GUARDAR CAMBIOS DEL D√çA</button></div>`;
                }
            }
            return `<div class="relative bg-card-bg/80 p-4 md:p-6 lg:p-8 rounded-lg shadow-lg border ${isHighIntensity ? 'metabolic-border metabolic-shadow' : 'border-border'}">
                        ${!isCurrentDay && isTodayView ? `<div class="text-center text-base md:text-lg text-accent-hover mb-4 font-bold px-3 py-2 bg-accent-hover/10 rounded-lg" style="text-shadow: 0 0 10px rgba(29, 255, 127, 0.8);">üìÖ EDITANDO: ${dateLabel.toUpperCase()}</div>` : ''}
                        ${progressHTML}
                        <h2 class="text-2xl md:text-3xl lg:text-4xl font-bold mb-1 text-center ${isHighIntensity ? 'metabolic-text' : 'text-primary'}">${routineData.title}</h2>
                        <p class="text-center text-secondary mb-2 text-sm md:text-base">${routineData.description}</p>
                        ${saveButtonHTML}
                    </div>`;
        }

        function createRoutineTableHTML(exercises, isTodayView, routineKey) {
            const rows = exercises.map((ex, index) => `
                <tr class="border-b border-border last:border-b-0 hover:bg-black/20 transition">
                    <td class="p-2 md:p-3 lg:p-4 font-medium text-primary text-sm md:text-base">
                        <div class="font-semibold flex items-center gap-1 md:gap-2"><span>${getExerciseName(ex.name)}</span><button class="exercise-info-btn text-[10px] px-1 py-0.5 rounded text-secondary/60 hover:text-accent/80 hover:bg-accent/10 transition" data-exercise="${ex.name}">üìö</button></div>
                        <div class="text-xs text-secondary hidden md:block">${getExerciseDescription(ex.name)}</div>
                    </td>
                    <td class="p-2 md:p-3 lg:p-4 text-center text-secondary text-sm md:text-base">${ex.series}</td>
                    <td class="p-2 md:p-3 lg:p-4 text-center text-secondary text-sm md:text-base">${ex.reps}</td>
                    <td class="p-2 md:p-3 lg:p-4 text-center text-secondary text-sm md:text-base">
                        <div class="flex justify-center items-center gap-1 md:gap-2"><span class="rest-text text-xs md:text-sm">${ex.rest}</span>
                        ${isTodayView ? `<button class="rest-timer-btn text-[10px] px-1 py-0.5 rounded text-accent/60 hover:text-accent hover:bg-accent/10 transition" data-rest="${ex.rest}">‚è±Ô∏è</button><span class="rest-countdown text-secondary text-xs"></span>` : ''}</div>
                    </td>
                    <td class="p-2 md:p-3 lg:p-4 text-xs md:text-sm text-secondary hidden md:table-cell">${ex.notes || ''}</td>
                    ${isTodayView ? `<td class="p-2 md:p-3 lg:p-4 text-center"><input type="checkbox" data-exercise-index="${index}" class="h-4 w-4 rounded bg-card-bg border-border accent-accent"></td>` : ''}
                </tr>
            `).join('');
            return `<div class="overflow-x-auto"><table class="w-full text-left"><thead class="bg-black/30"><tr><th class="p-2 text-xs text-secondary uppercase">${t('exercise')}</th><th class="p-2 text-xs text-center text-secondary uppercase">${t('sets')}</th><th class="p-2 text-xs text-center text-secondary uppercase">${t('reps')}</th><th class="p-2 text-xs text-center text-secondary uppercase">${t('rest')}</th><th class="p-2 text-xs text-secondary uppercase hidden md:table-cell">${t('notes')}</th>${isTodayView ? `<th class="p-2 text-xs text-center text-secondary uppercase">${t('done')}</th>` : ''}</tr></thead><tbody>${rows}</tbody></table></div>`;
        }

        function createRoutineHTML(routineKey, isTodayView, date) {
            const routineData = routines[routineKey];
            const colors = getRoutineColorClass(routineKey);
            
            if (routineKey === 'REST') {
                if (isTodayView) {
                    const allProgress = getStoredProgress();
                    const key = dateKeyFromDate(currentViewDate);
                    const restCompleted = allProgress[key] && allProgress[key][0];
                    return `<div class="space-y-6">
                                <div class="relative bg-card-bg/80 p-4 md:p-6 lg:p-8 rounded-lg shadow-lg border border-border">
                                    <div class="text-center">
                                        <h3 class="text-center font-bold text-xl mb-2 text-primary">ESTADO DE LA SECUENCIA DIARIA</h3>
                                        <div id="progress-text" class="text-center font-bold text-lg text-accent-hover" style="text-shadow: 0 0 15px rgba(29, 255, 127, 0.8);">${restCompleted ? '100% COMPLETADO' : '0% COMPLETADO'}</div>
                                        <div id="progress-count" class="text-center text-secondary text-sm mt-1">${restCompleted ? '‚úì' : '‚úó'} Descanso</div>
                                        <div class="progress-bar-container mt-3" style="height: 1rem;"><div id="progress-bar" class="progress-bar" style="width: ${restCompleted ? '100' : '0'}%; background: linear-gradient(90deg, ${restCompleted ? '#1dff7f' : '#00d4ff'} 0%, ${restCompleted ? '#1dff7f' : '#00f0ff'} 100%);"></div></div>
                                    </div>
                                </div>
                                <div class="p-8 text-center ${colors.bg} border ${colors.border} rounded-xl shadow-lg">
                                    <div class="text-4xl mb-4">üõå</div>
                                    <h2 class="text-3xl font-bold ${colors.text}">${routineData.title}</h2>
                                    <p class="text-secondary mt-2">${routineData.description}</p>
                                    <div class="mt-6 flex items-center justify-center gap-3">
                                        <input type="checkbox" id="rest-completed" class="w-6 h-6 accent-accent cursor-pointer" data-index="0" ${restCompleted ? 'checked' : ''} style="cursor: pointer;">
                                        <label for="rest-completed" class="text-accent font-bold cursor-pointer text-lg">D√≠a de Descanso Completado</label>
                                    </div>
                                </div>
                            </div>`;
                } else {
                    return `<div class="p-8 text-center ${colors.bg} border ${colors.border} rounded-xl shadow-lg">
                                <div class="text-4xl mb-4">üõå</div>
                                <h2 class="text-3xl font-bold ${colors.text}">${routineData.title}</h2>
                                <p class="text-secondary mt-2">${routineData.description}</p>
                            </div>`;
                }
            }
            if (!routineData || !routineData.details) return `<div class="p-8 text-center bg-card-bg/80">No hay rutina asignada.</div>`;

            const headerHTML = createRoutineHeaderHTML(routineData, routineKey, isTodayView, date);
            const tableHTML = createRoutineTableHTML(routineData.details.exercises, isTodayView, routineKey);
            
            const equipmentSet = new Set();
            routineData.details.exercises.forEach(ex => {
                if (ex.name.includes('Dumbbell')) equipmentSet.add('üèãÔ∏è Mancuernas');
                if (ex.name.includes('Pilates Bar')) equipmentSet.add('üéØ Barra Pilates');
                if (ex.name.includes('Band')) equipmentSet.add('üü∞ Bandas');
                if (ex.name.includes('Tapete') || ex.name.includes('Plank')) equipmentSet.add('üõèÔ∏è Tapete');
            });
            
            let equipmentHTML = equipmentSet.size > 0 && isTodayView ? `<div class="mt-8 p-5 bg-gradient-to-br from-black/50 to-black/30 border-2 border-metabolic/60 rounded-lg shadow-lg" style="box-shadow: 0 0 20px rgba(255, 0, 110, 0.3), inset 0 0 15px rgba(255, 0, 110, 0.1);"><h4 class="font-bold text-lg text-metabolic mb-4 flex items-center gap-2" style="text-shadow: 0 0 10px rgba(255, 0, 110, 0.8);">‚öôÔ∏è ${t('equipmentNeeded')}</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-3">${Array.from(equipmentSet).map(eq => `<div class="text-base font-semibold text-white bg-black/40 p-3 rounded-lg border border-metabolic/40 flex items-center gap-2" style="text-shadow: 0 0 5px rgba(255, 0, 110, 0.6);">${eq}</div>`).join('')}</div></div>` : '';

            return `<div class="space-y-6">${headerHTML}<div class="bg-card-bg/80 border border-border rounded-lg shadow-lg">${tableHTML}</div>${equipmentHTML}</div>`;
        }

        async function displayTodaysPlan(dateOverride) {
            const viewDate = dateOverride instanceof Date ? dateOverride : currentViewDate;
            const routineKey = monthlySchedule[viewDate.getDate()];
            document.getElementById('hoy').innerHTML = createRoutineHTML(routineKey, true, viewDate);
            await loadProgress();
        }

        // --- Logic ---
        function getStoredProgress() { try { return JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY)) || {}; } catch { return {}; } }

        function getHistoricalStats() {
            const allProgress = getStoredProgress();
            let stats = {
                totalWorkouts: 0,
                totalExercisesCompleted: 0,
                longestStreak: 0,
                currentStreak: 0,
                lastWorkoutDate: null,
                completedDays: []
            };
            
            // Calculate statistics
            const sortedDates = Object.keys(allProgress).sort();
            for (const dateStr of sortedDates) {
                const dayData = allProgress[dateStr];
                if (Array.isArray(dayData) && dayData.length > 0) {
                    const completed = dayData.filter(Boolean).length;
                    if (completed > 0) {
                        stats.totalWorkouts++;
                        stats.totalExercisesCompleted += completed;
                        stats.lastWorkoutDate = dateStr;
                        stats.completedDays.push(dateStr);
                    }
                }
            }
            
            // Calculate streaks
            let currentS = 0;
            let maxS = 0;
            for (let i = 0; i < stats.completedDays.length; i++) {
                const curr = new Date(stats.completedDays[i]);
                if (i === 0) {
                    currentS = 1;
                } else {
                    const prev = new Date(stats.completedDays[i - 1]);
                    const diffTime = Math.abs(curr - prev);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    if (diffDays === 1) {
                        currentS++;
                    } else {
                        maxS = Math.max(maxS, currentS);
                        currentS = 1;
                    }
                }
            }
            stats.longestStreak = Math.max(maxS, currentS);
            
            return stats;
        }

        function loadProgress() {
            const allProgress = getStoredProgress();
            const key = dateKeyFromDate(currentViewDate);
            const todaysData = allProgress[key] || [];
            document.querySelectorAll('#hoy input[type="checkbox"]').forEach((cb, idx) => cb.checked = !!todaysData[idx]);
            updateProgressUI();
        }

        function saveProgress() {
            const checkboxes = document.querySelectorAll('#hoy input[type="checkbox"]');
            const state = Array.from(checkboxes).map(cb => cb.checked);
            const allProgress = getStoredProgress();
            allProgress[dateKeyFromDate(currentViewDate)] = state;
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(allProgress));
            updateProgressUI();
            updateGlobalProgress();
            generateCalendar();
            checkDayCompletion();
        }

        function updateProgressUI() {
            const checkboxes = document.querySelectorAll('#hoy input[type="checkbox"]');
            if(checkboxes.length === 0) return;
            const checked = Array.from(checkboxes).filter(c => c.checked).length;
            const pct = Math.round((checked/checkboxes.length)*100);
            const bar = document.getElementById('progress-bar');
            const text = document.getElementById('progress-text');
            const count = document.getElementById('progress-count');
            const routineKey = monthlySchedule[currentViewDate.getDate()];
            const isRestDay = routineKey === 'REST';
            if(bar) bar.style.width = `${pct}%`;
            if(text) text.innerText = `${pct}% COMPLETADO`;
            if(count) {
                if (isRestDay) {
                    count.innerText = `${checked > 0 ? '‚úì' : '‚úó'} Descanso`;
                } else {
                    count.innerText = `${checked} de ${checkboxes.length} m√≥dulos`;
                }
            }
        }

        function updateGlobalProgress() {
            const allProgress = getStoredProgress();
            const stats = getHistoricalStats();
            let total = 0, completed = 0;
            for (let d = 1; d <= daysInMonth; d++) {
                const r = routines[monthlySchedule[d]];
                if (r && r.details) {
                    total += r.details.exercises.length;
                    const dayP = allProgress[`${year}-${month + 1}-${d}`] || [];
                    completed += dayP.filter(Boolean).length;
                }
            }
            const pct = total > 0 ? Math.round((completed / total) * 100) : 0;
            document.getElementById('global-progress-bar').style.width = `${pct}%`;
            document.getElementById('global-progress-text').textContent = `${pct}% CONSOLIDADO`;
            
            // Update global stats if element exists
            const globalStatsEl = document.getElementById('global-stats');
            if (globalStatsEl) {
                globalStatsEl.innerHTML = `
                    <div class="grid grid-cols-3 gap-2 text-center text-sm">
                        <div class="p-2 bg-black/30 rounded border border-accent/30">
                            <div class="text-secondary text-xs">RACHA</div>
                            <div class="text-accent font-bold">${stats.longestStreak}d</div>
                        </div>
                        <div class="p-2 bg-black/30 rounded border border-accent/30">
                            <div class="text-secondary text-xs">WORKOUTS</div>
                            <div class="text-accent font-bold">${stats.totalWorkouts}</div>
                        </div>
                        <div class="p-2 bg-black/30 rounded border border-accent/30">
                            <div class="text-secondary text-xs">EJERCICIOS</div>
                            <div class="text-accent font-bold">${stats.totalExercisesCompleted}</div>
                        </div>
                    </div>
                `;
            }
        }

        function generateCalendar() {
            const calendarBody = document.getElementById('calendar-body');
            if (!calendarBody) return;
            const firstDay = new Date(year, month, 1).getDay();
            const offset = (firstDay === 0) ? 6 : firstDay - 1;
            const allProgress = getStoredProgress();
            const isMobile = window.innerWidth <= 768;
            const dayNames = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];

            let html = '';
            
            // Only add offset for desktop grid
            if (!isMobile) {
                for (let i = 0; i < offset; i++) html += `<div class="bg-black/20 rounded-md"></div>`;
            }

            for (let d = 1; d <= daysInMonth; d++) {
                const key = monthlySchedule[d];
                const act = routines[key];
                const isToday = d === today.getDate() && month === today.getMonth() && year === today.getFullYear();
                const colors = getRoutineColorClass(key);
                const dayP = allProgress[`${year}-${month + 1}-${d}`] || [];
                const dateObj = new Date(year, month, d);
                const dayOfWeek = dayNames[dateObj.getDay()];
                
                // Get emoji and short description
                let emoji = '';
                let shortDesc = '';
                if (key === 'REST') {
                    emoji = 'üõå';
                    shortDesc = 'Descanso';
                } else {
                    const titleParts = act.title.split(':');
                    emoji = titleParts[0].trim().split(' ')[0];
                    shortDesc = titleParts[1] ? titleParts[1].trim().split(' ').slice(0, 3).join(' ') : 'Entrenamiento';
                }
                
                // Calculate progress percentage
                let badge = '';
                let progressBar = '';
                let pct = 0;
                if (act.details) {
                    pct = act.details.exercises.length > 0 ? Math.round((dayP.filter(Boolean).length / act.details.exercises.length) * 100) : 0;
                    if(pct > 0) {
                        const barColor = pct === 100 ? 'bg-emerald-500' : 'bg-amber-500';
                        badge = `<span class="inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded-full ${pct===100?'bg-emerald-500/20 text-emerald-300':'bg-amber-500/20 text-amber-300'} font-bold">${pct===100?'‚úì':''} ${pct}%</span>`;
                        progressBar = `<div class="w-full h-1 bg-black/40 rounded-full overflow-hidden mt-1"><div class="h-full ${barColor} transition-all" style="width: ${pct}%"></div></div>`;
                    } else {
                        progressBar = `<div class="w-full h-1 bg-black/40 rounded-full mt-1"></div>`;
                    }
                }

                if (isMobile) {
                    // Mobile list layout - improved with day name
                    html += `<div class="calendar-day ${colors.bg} rounded-lg border-2 ${colors.border} cursor-pointer hover:shadow-lg transition-all ${isToday ? 'today ring-2 ring-accent' : ''}" data-date="${year}-${month + 1}-${d}">
                                <div class="flex items-center gap-4 flex-1">
                                    <div class="flex flex-col items-center min-w-[50px]">
                                        <div class="text-[10px] uppercase text-secondary/70 font-semibold">${dayOfWeek}</div>
                                        <div class="text-2xl font-bold ${isToday ? 'text-accent' : 'text-primary'}">${d}</div>
                                    </div>
                                    <div class="flex-1">
                                        <div class="text-sm font-semibold ${colors.text}">${shortDesc}</div>
                                        ${act.details ? `<div class="text-xs text-secondary/60">${act.details.exercises.length} ejercicios</div>` : '<div class="text-xs text-secondary/60">Recuperaci√≥n activa</div>'}
                                        ${progressBar}
                                    </div>
                                </div>
                                <div class="flex flex-col items-end gap-1">
                                    <div class="text-3xl">${emoji}</div>
                                    ${badge}
                                </div>
                            </div>`;
                } else {
                    // Desktop grid layout - improved
                    html += `<div class="calendar-day ${colors.bg} rounded-lg border-2 ${colors.border} flex flex-col cursor-pointer hover:shadow-lg hover:scale-105 transition-all ${isToday ? 'today ring-2 ring-accent ring-offset-2 ring-offset-black' : ''}" data-date="${year}-${month + 1}-${d}" style="min-height: 110px;">
                                <div class="flex items-center justify-between mb-1">
                                    <div class="font-bold text-base ${isToday ? 'text-accent' : 'text-primary'}">${d}</div>
                                    <div class="text-xl">${emoji}</div>
                                </div>
                                <div class="text-[11px] font-semibold ${colors.text} leading-tight mb-1">${shortDesc}</div>
                                ${act.details ? `<div class="text-[10px] text-secondary/60">${act.details.exercises.length} ejercicios</div>` : '<div class="text-[10px] text-secondary/60">Recuperaci√≥n</div>'}
                                <div class="mt-auto">
                                    ${progressBar}
                                    <div class="mt-1">${badge}</div>
                                </div>
                             </div>`;
                }
            }
            calendarBody.innerHTML = html;
        }

        function launchConfetti() {
            for(let i=0; i<50; i++) {
                const c = document.createElement('div');
                c.classList.add('confetti');
                c.style.left = Math.random() * 100 + 'vw';
                c.style.backgroundColor = `hsl(${Math.random()*360}, 100%, 50%)`;
                c.style.animationDuration = (Math.random() * 2 + 2) + 's';
                document.body.appendChild(c);
                setTimeout(() => c.remove(), 4000);
            }
        }

        function checkDayCompletion() {
            const checkboxes = document.querySelectorAll('#hoy input[type="checkbox"]');
            if (checkboxes.length === 0) return;
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            const key = `celebrated_${dateKeyFromDate(currentViewDate)}`;
            if (allChecked && !sessionStorage.getItem(key)) {
                sessionStorage.setItem(key, 'true');
                launchConfetti();
                document.getElementById('progress-text').innerText = '¬°PROTOCOLO CUMPLIDO! üéâ';
            }
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', async () => {
            const modal = document.getElementById('exercise-modal');
            const title = document.getElementById('guide-title');
            const content = document.getElementById('guide-content');
            
            window.openExerciseInfo = (name) => {
                const data = exerciseLibrary[name] || { category: 'N/A', equipment: 'N/A', difficulty: 'N/A', form: { es: ['N/A'] }, tips: { es: ['N/A'] }, muscleGroups: ['N/A'] };
                title.textContent = name;
                content.innerHTML = `<div class="space-y-4"><div class="flex flex-wrap gap-2"><span class="px-3 py-1 bg-accent/20 text-accent text-xs font-semibold rounded-full">${data.category}</span></div><h4 class="font-bold">Forma:</h4><ul class="list-decimal pl-4 text-sm">${(data.form.es||[]).map(s=>`<li>${s}</li>`).join('')}</ul><h4 class="font-bold">Tips:</h4><div class="text-sm">${(data.tips.es||[]).map(t=>`<p>${t}</p>`).join('')}</div></div>`;
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            };

            document.getElementById('modal-close').addEventListener('click', () => { modal.classList.add('hidden'); modal.classList.remove('flex'); });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', async () => {
                    // Si es el bot√≥n "Hoy", siempre regresa a la fecha actual
                    if (tab.dataset.tab === 'hoy') {
                        currentViewDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                        await displayTodaysPlan(currentViewDate);
                    }
                    
                    document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('tab-active'));
                    document.getElementById(tab.dataset.tab).classList.add('active');
                    tab.classList.add('tab-active');
                });
            });

            document.getElementById('rutinas').addEventListener('click', (e) => {
                const btn = e.target.closest('.routine-selector');
                if (btn) document.getElementById('routine-details-container').innerHTML = createRoutineHTML(btn.dataset.routine, false, null);
            });

            document.body.addEventListener('click', (e) => {
                if(e.target.closest('.exercise-info-btn')) openExerciseInfo(e.target.closest('.exercise-info-btn').dataset.exercise);
                if(e.target.closest('.rest-timer-btn')) {
                    const btn = e.target.closest('.rest-timer-btn');
                    let val = parseInt(btn.dataset.rest);
                    const display = btn.nextElementSibling;
                    btn.textContent = '‚èπ';
                    const int = setInterval(() => { val--; display.innerText = val+'s'; if(val<=0){ clearInterval(int); btn.textContent='‚è±Ô∏è'; display.innerText='LISTO'; } }, 1000);
                }
                // Bot√≥n de guardar d√≠a del calendario
                if(e.target.closest('#save-day-btn')) {
                    saveProgress();
                    const btn = e.target.closest('#save-day-btn');
                    const originalText = btn.textContent;
                    btn.textContent = '‚úì GUARDADO';
                    btn.style.backgroundColor = 'rgba(29, 255, 127, 0.3)';
                    btn.style.borderColor = 'rgb(29, 255, 127)';
                    btn.style.color = 'rgb(29, 255, 127)';
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.style.backgroundColor = '';
                        btn.style.borderColor = '';
                        btn.style.color = '';
                    }, 2000);
                }
            });

            document.getElementById('hoy').addEventListener('change', (e) => { if(e.target.matches('input')) saveProgress(); });
            
            document.getElementById('calendar-body').addEventListener('click', (e) => {
                const cell = e.target.closest('.calendar-day');
                if(cell) {
                    const [y,m,d] = cell.dataset.date.split('-').map(Number);
                    currentViewDate = new Date(y, m-1, d);
                    displayTodaysPlan(currentViewDate);
                    // No hacemos click en 'hoy', el calendario es independiente
                    document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('tab-active'));
                    document.getElementById('hoy').classList.add('active');
                    document.querySelector('[data-tab="hoy"]').classList.add('tab-active');
                }
            });

            updateLanguageDisplay();
            await displayTodaysPlan();
            generateCalendar();
            updateGlobalProgress();
            
            // Regenerate calendar on window resize for responsive behavior
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    generateCalendar();
                }, 250);
            });
            
            // Generate Library
            const libContainer = document.getElementById('exercise-library');
            const allEx = new Set();
            Object.values(routines).forEach(r=>r.details?.exercises.forEach(e=>allEx.add(e.name)));
            // Ordenar alfab√©ticamente
            const sortedEx = Array.from(allEx).sort((a, b) => a.localeCompare(b, 'es'));
            libContainer.innerHTML = `<div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">${sortedEx.map((name, idx) => {
                const firstLetter = name.charAt(0).toUpperCase();
                const showLetter = idx === 0 || sortedEx[idx - 1].charAt(0).toUpperCase() !== firstLetter;
                return `${showLetter ? `<div class="col-span-full"><h3 class="text-2xl font-bold text-accent mt-4 mb-2" style="text-shadow: 0 0 10px rgba(0, 212, 255, 0.8);">üìå ${firstLetter}</h3></div>` : ''}
                <div class="p-4 bg-gradient-to-br from-black/50 to-black/30 border border-accent/50 rounded-lg cursor-pointer hover:border-accent/80 hover:bg-accent/15 hover:shadow-lg shadow-md transition duration-300 transform hover:scale-105" onclick="openExerciseInfo('${name}')" style="box-shadow: 0 0 10px rgba(0, 212, 255, 0.2);">
                    <h3 class="font-bold text-accent text-base leading-tight">${name}</h3>
                    <div class="text-xs text-secondary/70 mt-1 opacity-0 group-hover:opacity-100 transition">Click para detalles ‚Üí</div>
                </div>`;
            }).join('')}</div>`;

            document.querySelector('[data-tab="hoy"]').classList.add('tab-active');
            document.getElementById('hoy').classList.add('active');
        });
    </script>
</body>
</html>

